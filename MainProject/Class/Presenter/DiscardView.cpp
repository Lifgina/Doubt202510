//
// DiscardView.cpp
//

#include "DiscardView.h"
#include <numbers>

using namespace HE;

void DiscardView::Load()
{
	for (int i = 0; i < 52; i++) {
		m_cardSprite[i] = Sprite("CardBack.png");
		m_cardSprite[i].params.siz = Math::Vector2(100.0f, 150.0f); // ?J?[?h??T?C?Y????
		RenderingPath->AddSprite(&m_cardSprite[i], 1000); // ?????_?????O?p?X????
	}
	m_discardFont.params.style = Font::AddFontStyle("Fonts/meiryob004.ttf");
	m_discardFont.params.size = 36; // ?t?H???g?T?C?Y????
	m_discardFont.params.color = Color(0.0f, 0.0f, 0.0f); // ?t?H???g??F????
	RenderingPath->AddFont(&m_discardFont, 1000); // ?????_?????O?p?X????
}

void DiscardView::Initialize(int playerCount, int myPlayerID)
{
	m_myPlayerID = myPlayerID; // ??????v???C???[ID????
	m_playerCount = playerCount; // ?v???C???[??l??????
	for (int i = 0; i < 52; i++) {
		m_cardSprite[i].params.pos = Math::Vector2(640.0f, 300.0f); // ?J?[?h???u????
		m_cardSprite[i].params.pivot = Math::Vector2(0.5, 0.5); // ?J?[?h??s?{?b?g????????
		m_cardSprite[i].SetHidden(true); // ?????????J?[?h??????????
	}
	m_discardFont.params.posX = 350.0f; // ???D???????????u????
	m_discardFont.params.posY = 200.0f; // ???D???????????u????
	m_discardFont.SetText(L"???D:0??"); // ???D????????????Z?b?g
}

void DiscardView::Discard(int playerID, int currentDiscardCount)
{
	for (int i = 0; i < currentDiscardCount; i++)
	{
		m_discardCount += 1;
		m_cardSprite[m_discardCount].SetHidden(false);
		m_cardSprite[m_discardCount].params.pos.x = 640.0f - 20.0f*(currentDiscardCount-1) + 40.0f * (i); // ?J?[?h???u????
		m_cardSprite[m_discardCount].params.rotation = 2 * std::numbers::pi / m_playerCount * (playerID + m_playerCount - m_myPlayerID % m_playerCount); // ??]?p?x????
	}
	m_discardFont.SetText(L"???D:"+std::to_wstring(m_discardCount)+L"??"); // ???D?????????
}

void DiscardView::ResetDiscard()
{
	for (int i = 0; i < 52; i++) {
		m_cardSprite[i].SetHidden(true); // ?S???J?[?h??????????
		m_cardSprite[i].params.pos = Math::Vector2(640.0f, 300.0f); // ?J?[?h???u???????
	}
	m_discardCount = 0; // ???D?????????Z?b?g
	m_discardFont.SetText(L"???D:0??"); // ???D????????????Z?b?g
}